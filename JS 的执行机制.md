# JS 的执行机制

## 单线程

* JS 是一门单线程的脚本语言，所谓单线程就是指任务执行的顺序需要一个接一个，如果其中某一个任务执行的时候需要占用大量的时间，
  那么后面的任务就必须等着。基于以上场景，JS中诞生了一种叫做事件循环的机制，用以解决JS中异步执行任务的方式。

## 执行栈

* JS在执行时也是有类似Java的执行栈的，被执行的函数一个一个的被推入执行栈执行，如果执行栈中的函数超过了栈所能承载的容量，也是会发生栈内存溢出的。

## 事件循环（EventLoop）

```
  一种事件循环机制，用以解决JS中异步执行任务的方式
```

1. 当一个网页被加载时，有同步执行任务也有需要异步执行的任务（耗时大的），JS脚本执行顺序自上而下，当遇到同步任务时，同步任务就会进入主线程的执行栈中按照顺序执行
2. 一旦遇到异步任务，该异步任务就会进入EventLoop的EventTable事件表中注册好该异步函数
3. 等到该异步任务执行完毕后，EventTable中的函数就会进入EventLoop的EventQueue任务队列中
4. 当主线程内的同步任务执行完毕为空的时候，主线程会去Event Queue读取对应的函数，进入主线程执行

## 宏任务与微任务

```
  1. 不论是宏任务还是微任务皆属于JS异步任务范畴，只是它们的在EventLoop中的走向与取值不同，也就是执行顺序不同
  2. 另一点就是同类型的任务会进入到同类型的队列中
```

### 宏任务

宏任务一般包括：整体Script代码，setTimeout，setInterval以及setImmediate

### 微任务

微任务一般包括：Promise，process.nextTick，MutationObserver

JS每执行完一个宏任务后，都回去清空一次微任务队列，然后执行下一个宏任务。这种不断循环的方式就是JS的执行机制，叫做事件循环。


